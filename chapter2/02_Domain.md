# 领域模型层

领域模层使用JPA作为领域模型的实现，在此基础上，也可通过增加接口的方式，先定义领域模型应具备的功能，再将JPA作为该功能的一个实现方式，这里不强求在领域模型上使用接口，但需要保证领域模型为标准的POJO对象，并通过annotation的注解，使JPA能识别该POJO为领域模型。

领域模型作为整个开发数据流的底层，肩负着最终持久化到数据库的责任，同时，为了实现数据的简单、一致的原则，在由Domain层通过Repository、Service、Controller层之后，可能直接在界面层中展现，所以要求领域模型能最大限度的反映业务需求，包括父子结构、Blob的处理、使用关联还是不使用关联而直接存取引用字段等都是需要考量的范畴。

除此之外，macula开发平台对领域模型层的实现，有如下的建议：

## 5.1 主键策略


    
## 5.2 数据审计 



## 5.3 变化日志




## 5.4 领域模型接口

在领域模型层，macula开发平台并没有过多的要求，只需要领域模型满足POJO规范，并实现了JPA规范要求的即可，这里列出为方便领域模型层的编写，有下列辅助类可以使用：

* AbstractPersistable：用来标识领域模型是可持久化的，并可通过泛型传入主键类型（一般情况下都是Long），这样可减少编写Id的工作量。

* AbstractAuditable：用来标识领域模型是可审计的，即增加了审计的四个字段。

* AuditChanged：用来记录变更的数据日志。


## 5.5 领域模型数据及关联定义原则

在定义领域模型之间的关系时，考虑到性能问题，可遵循如下原则：

* 减少Blob与Clob类型字段

    应尽量减少领域模型中Blob与Clob字段的定义，如果不可避免，应提供不含该Blob/Clob字段的构造，以方便在列表查询时，不用查询出该字段列，减少构建领域模型所需的内存，特别是当所载入的字段列数据并不关心时。
    
    如当列表显示时，可不查询出该字段，而在单个数据查看时，可查询出该字段，以方便展示给用户。
    
* 子表数据量较少时，可使用一对多关联

    在业务数据的定义中，会存在大量的父子关系的表，如销售单和销售单明细等，在定义的过程中，可定义成一对多的关联关系。

    而对于业务分组与分组内的数据，则不宜定义成一对多的关系，而直接定义成简单类型数据，因为这类情况下，子表中数据量较大，定义成一对多的关系也不能解决数据批量查询的问题，以及在父表加载时，大量载入子表内容，容易造成内存的浪费。




 







